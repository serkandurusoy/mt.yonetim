<template name="sinavDetay">
  {{#unless Template.subscriptionsReady}}
      <div class="loading padTopBlock center">
        {{> loading}}
      </div>
  {{else}}
    {{#unless sinav}}
      {{>notFound}}
    {{else}}
      {{#with sinav}}
        {{>sinavDetayKart}}
        {{#if aktif}}
          {{>comments}}
        {{/if}}
        {{#unless iptal}}
          {{#unless userHasRole "mudur"}}
            {{#if ogretmenCanEdit}}
              {{#if $or sinavStatusGuncellenebilir ($or ($or (kilitlenebilir) (taslakDegisebilir)) ($or ($and ($not muhur) ($not kilitli)) (sinavIptalEdilebilir)))}}
                <div class="fixed-action-btn click-to-toggle" style="bottom: 24px; right: 86px;">
                  <a title="Sınav işlemleri" class="btn-floating btn-large grey">
                    <i class="large material-icons">more_vert</i>
                  </a>
                  <ul>
                    {{#if sinavStatusGuncellenebilir}}
                      {{#if $in canliStatus 'pending' 'paused'}}
                        <li><a class="btn-floating green" title="Sınavı {{#if $eq canliStatus 'pending'}}başlat{{else}}devam ettir{{/if}}" data-trigger="baslat"><i class="material-icons">play_arrow</i></a></li>
                      {{/if}}
                      {{#if $eq canliStatus 'running'}}
                        <li><a class="btn-floating blue" title="Sınavı beklemeye al" data-trigger="durdur"><i class="material-icons">pause</i></a></li>
                      {{/if}}
                      {{#if $in canliStatus 'paused' 'running'}}
                        <li><a class="btn-floating red" title="Sınavı bitir" data-trigger="sinavBitirModal"><i class="material-icons">stop</i></a></li>
                      {{/if}}
                    {{/if}}
                    {{#if sinavIptalEdilebilir}}
                      <li><a class="btn-floating red" title="Sınavı iptal et" data-trigger="sinavIptalModal"><i class="material-icons">cancel</i></a></li>
                    {{/if}}
                    {{#if kilitlenebilir}}
                      <li><a class="btn-floating red" title="Sınavı kilitle" data-trigger="sinavKilitleModal"><i class="material-icons">lock</i></a></li>
                    {{/if}}
                    {{#if taslakDegisebilir}}
                      <li><a class="btn-floating blue" title="{{#if taslak}}Sınavın taslak işaretini kaldır{{else}}Sınavı taslak olarak işaretle{{/if}}" data-trigger="sinavTaslakDegistirModal"><i class="material-icons">edit</i></a></li>
                    {{/if}}
                    {{#if $and ($not muhur) ($not kilitli)}}
                      <li><a class="btn-floating green" title="Sınava soru ekle" data-trigger="soruEkleModal"><i class="material-icons">local_library</i></a></li>
                    {{/if}}
                  </ul>
                </div>
              {{/if}}
            {{/if}}
          {{/unless}}
        {{/unless}}
      {{/with}}
    {{/unless}}
  {{/unless}}
</template>

<template name="sinavBitirModal">
  <div id="sinavBitirModal" class="modal bottom-sheet modal-fixed-footer">
    <div class="modal-content">
      <div class="row">
        <div class="col s10 offset-s1 center-align">
          <p>
            <i class="material-icons large red-text">stop</i>
          </p>
          <p>
            Bu sınavı bitirmek istediğinize emin misiniz?
          </p>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <a class="modal-action modal-close waves-effect waves-green btn-flat ">VAZGEÇ</a>
      <a data-trigger="bitir" class="modal-action waves-effect waves-red btn-flat ">EVET</a>
    </div>
  </div>
</template>

<template name="sinavKilitleModal">
  <div id="sinavKilitleModal" class="modal bottom-sheet modal-fixed-footer">
    <div class="modal-content">
        <div class="row">
          <div class="col s10 offset-s1 center-align">
            <p>
              <i class="material-icons large red-text">lock</i>
            </p>
            <p>
              Bu sınavı kilitlemek istediğinize emin misiniz?
            </p>
          </div>
        </div>
    </div>
    <div class="modal-footer">
      <a class="modal-action modal-close waves-effect waves-green btn-flat ">VAZGEÇ</a>
      <a data-trigger="kilitle" class="modal-action waves-effect waves-red btn-flat ">EVET</a>
    </div>
  </div>
</template>

<template name="sinavTaslakDegistirModal">
  <div id="sinavTaslakDegistirModal" class="modal bottom-sheet modal-fixed-footer">
    <div class="modal-content">
        <div class="row">
          <div class="col s10 offset-s1 center-align">
            <p>
              <i class="material-icons large blue-text">edit</i>
            </p>
            <p>
              {{#if taslak}}
                Bu sınavın taslak işaretini kaldırmak istediğinize emin misiniz?
              {{else}}
                Bu sınavı taslak olarak işaretlemek istediğinize emin misiniz?
              {{/if}}
            </p>
          </div>
        </div>
    </div>
    <div class="modal-footer">
      <a class="modal-action modal-close waves-effect waves-green btn-flat ">VAZGEÇ</a>
      <a data-trigger="taslakDegistir" class="modal-action waves-effect waves-red btn-flat ">EVET</a>
    </div>
  </div>
</template>

<template name="sinavIptalModal">
  <div id="sinavIptalModal" class="modal bottom-sheet modal-fixed-footer">
    <div class="modal-content">
        <div class="row">
          <div class="col s10 offset-s1 center-align">
            <p>
              <i class="material-icons large red-text">cancel</i>
            </p>
            <p>
              Bu sınavı iptal etmek istediğinize emin misiniz?
            </p>
          </div>
        </div>
    </div>
    <div class="modal-footer">
      <a class="modal-action modal-close waves-effect waves-green btn-flat ">VAZGEÇ</a>
      <a data-trigger="iptal" class="modal-action waves-effect waves-red btn-flat ">EVET</a>
    </div>
  </div>
</template>

<template name="soruEkleModal">
  <div id="soruEkleModal" class="modal bottom-sheet modal-fixed-footer">
    <div class="modal-content">
      {{#unless sorular}}
        <div class="row">
          <div class="col s10 offset-s1 center-align">
            <p>
              <i class="material-icons large">add_shopping_cart</i>
            </p>
            <p>
              Sepette sınava eklenebilme şartlarını sağlayan bir soru bulunamadı.
            </p>
          </div>
        </div>
      {{else}}
        <ul class="collection with-header">
          <li class="collection-header right-align"><a data-trigger="tumunuEkle" title="Tümünü Ekle">Tümünü Ekle</a></li>
          {{#each sorular}}
            {{>soruEkleKart}}
          {{/each}}
        </ul>
      {{/unless}}
    </div>
    <div class="modal-footer">
      <a class="modal-action modal-close waves-effect waves-green btn-flat ">KAPAT</a>
    </div>
  </div>
</template>

<template name="soruEkleKart">
  <li class="collection-item {{#unless aktif}}pasif{{/unless}}">
    <div>
      <a title="Detay gör" class="secondary-content" href="{{pathFor 'soruDetay' _id=_id}}"><i class="material-icons">chevron_right</i></a>
      <a data-trigger="ekle" title="Soruyu sınava ekle" class="secondary-content margin-right-6px"><i class="green-text material-icons">local_library</i></a>
      {{foreignField 'Dersler' alan.ders 'isim'}}<br>
      {{alan.egitimYili}} / {{alan.konu}}<br>
      {{zorlukDerecesi}} ZD / {{enumLabel tip}}<br>
      Kazanımlar:<br>
      {{#each alan.kazanimlar}}{{this}}<br>{{/each}}
      Soru: {{kod}}<br>
      {{soru.yonerge}}
    </div>
  </li>
</template>

<template name="soruCikarModal">
  <div id="soruCikarModal" class="modal bottom-sheet modal-fixed-footer">
    <div class="modal-content">
      <div class="row">
        <div class="col s10 offset-s1 center-align">
          <p>
            <i class="material-icons large red-text">cancel</i>
          </p>
          <p>
            Bu soruyu sınavdan çıkarmak istediğinize emin misiniz?
          </p>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <a class="modal-action modal-close waves-effect waves-green btn-flat ">VAZGEÇ</a>
      <a data-trigger="cikar" class="modal-action waves-effect waves-red btn-flat ">EVET</a>
    </div>
  </div>
</template>

<template name="sorularinTumunuCikarModal">
  <div id="sorularinTumunuCikarModal" class="modal bottom-sheet modal-fixed-footer">
    <div class="modal-content">
      <div class="row">
        <div class="col s10 offset-s1 center-align">
          <p>
            <i class="material-icons large red-text">cancel</i>
          </p>
          <p>
            Soruların tümünü sınavdan çıkarmak istediğinize emin misiniz?
          </p>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <a class="modal-action modal-close waves-effect waves-green btn-flat ">VAZGEÇ</a>
      <a data-trigger="cikar" class="modal-action waves-effect waves-red btn-flat ">EVET</a>
    </div>
  </div>
</template>

<template name="sinavOgrencilerModal">
  <div id="sinavOgrencilerModal" class="modal modal-fixed-footer">
    <div class="modal-content">
      {{#each subeler}}
        <table class="striped responsive-table">
          <thead>
            <tr>
              <th>Öğrenci</th>
              <th>Başlama</th>
              <th>Bitirme</th>
            </tr>
          </thead>
          <tbody>
          {{#each ogrenciler this}}
            <tr class="{{#unless sinavKagidi _id}}grey-text{{/unless}}">
              <td>{{name}} {{lastName}}</td>
              {{#with sinavKagidi _id}}
                <td>{{#with baslamaZamani}}{{moFromNow this}}{{else}}...{{/with}}</td>
                <td>{{#with bitirmeZamani}}{{moFromNow this}}{{else}}...{{/with}}</td>
              {{/with}}
            </tr>
          {{/each}}
          </tbody>
        </table>
      {{/each}}
    </div>
    <div class="modal-footer">
      <a class="modal-action modal-close waves-effect waves-green btn-flat ">KAPAT</a>
    </div>
  </div>
</template>
